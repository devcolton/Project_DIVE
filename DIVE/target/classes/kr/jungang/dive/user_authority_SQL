DROP TABLE PERSISTENT_LOGINS;
DROP TABLE TBL_AUTHORITIES;
DROP SEQUENCE SEQ_AUTHORITIES;
DROP TABLE TBL_USER;
DROP SEQUENCE SEQ_USER;

--USER 시퀀스 생성
CREATE SEQUENCE SEQ_USER;
--USER 테이블 생성
CREATE TABLE TBL_USER (
ID NUMBER(10), 	
USER_ID VARCHAR2(50) UNIQUE NOT NULL, 
PASSWORD VARCHAR2(100) NOT NULL, 
NAME VARCHAR2(50), 
NICKNAME VARCHAR2(50), 
SEX CHAR(1) NOT NULL, 
BIRTHDAY CHAR(10) NOT NULL, 
ADDRESS VARCHAR2(100), 
PHONE VARCHAR2(50), 
EMAIL VARCHAR2(50), 
REG_DATE DATE DEFAULT SYSDATE, 		
UPDATE_DATE DATE DEFAULT SYSDATE, 		
ENABLED CHAR(1) DEFAULT '1', 
CONSTRAINT PK_USER PRIMARY KEY(ID)
);


--INDEX 생성 : FULL SCAN에서 FAST FULL SCAN으로 바뀜
CREATE INDEX IDX_USER_ID ON TBL_USER(ID, PASSWORD);


--권한 시퀀스 생성
CREATE SEQUENCE SEQ_AUTHORITIES;
--권한 테이블 생성
CREATE TABLE TBL_AUTHORITIES ( 	
ID NUMBER(10) NOT NULL, 
AUTHORITY VARCHAR2(100) NOT NULL,
--ON DELETE CASCADE는 참조하는 데이터 삭제시 FK함께 삭제, ON DELETE SET NULL은 참조하는 테이블의 데이터 삭제시 해당값을 NULL로 변경
CONSTRAINT FK_AUTHORITIES FOREIGN KEY(ID) REFERENCES TBL_USER(ID) ON DELETE CASCADE
);
 
 --자동로그인 관련 테이블 생성
 CREATE TABLE PERSISTENT_LOGINS (
 USERNAME VARCHAR2(50) NOT NULL,
 SERIES VARCHAR2(50),
 TOKEN VARCHAR2(50),
 LAST_USED TIMESTAMP NOT NULL,
 CONSTRAINT PK_TBL_PERSISTENT_LOGINS PRIMARY KEY(SERIES)
 );
DROP TABLE PERSISTENT_LOGINS;
DROP TABLE TBL_AUTHORITIES;
DROP TABLE TBL_PRODUCT;
DROP TABLE TBL_ATTACH;
DROP TABLE TBL_REPLY;
DROP TABLE TBL_POST;
DROP TABLE TBL_USER;

 

DROP SEQUENCE SEQ_POST;
DROP SEQUENCE SEQ_REPLY;
DROP SEQUENCE SEQ_PRODUCT;
DROP SEQUENCE SEQ_AUTHORITIES;
DROP SEQUENCE SEQ_USER;

 

--USER 시퀀스 생성
CREATE SEQUENCE SEQ_USER;
--권한 시퀀스 생성
CREATE SEQUENCE SEQ_AUTHORITIES;
-- 상품 시퀀스 생성
CREATE SEQUENCE SEQ_PRODUCT;
-- 게시글 시퀀스 셍성
CREATE SEQUENCE SEQ_POST;
-- 댓글 시퀀스 생성
CREATE SEQUENCE SEQ_REPLY;

 

--USER 테이블 생성
CREATE TABLE TBL_USER (
ID NUMBER(10),     
USER_ID VARCHAR2(50) NOT NULL, 
PASSWORD VARCHAR2(100) NOT NULL, 
NAME VARCHAR2(50), 
NICKNAME VARCHAR2(50), 
SEX CHAR(1) NOT NULL, 
BIRTHDAY CHAR(10) NOT NULL, 
ADDRESS VARCHAR2(100), 
PHONE VARCHAR2(50), 
EMAIL VARCHAR2(50), 
REG_DATE DATE DEFAULT SYSDATE,         
UPDATE_DATE DATE DEFAULT SYSDATE,         
ENABLED CHAR(1) DEFAULT '1', 
CONSTRAINT PK_USER PRIMARY KEY(ID)
);

 

--INDEX 생성 : FULL SCAN에서 FAST FULL SCAN으로 바뀜
CREATE INDEX IDX_USER_NUM ON TBL_USER(ID, PASSWORD);

 

--권한 테이블 생성
CREATE TABLE TBL_AUTHORITIES (     
USER_NUM NUMBER(10) NOT NULL, 
AUTHORITY VARCHAR2(100) NOT NULL,
--ON DELETE CASCADE는 참조하는 데이터 삭제시 FK함께 삭제, ON DELETE SET NULL은 참조하는 테이블의 데이터 삭제시 해당값을 NULL로 변경
CONSTRAINT FK_AUTHORITIES FOREIGN KEY(USER_NUM) REFERENCES TBL_USER(ID) ON DELETE CASCADE
);

 

 --자동로그인 관련 테이블 생성
 CREATE TABLE PERSISTENT_LOGINS (
 USERNAME VARCHAR2(50) NOT NULL,
 SERIES VARCHAR2(50),
 TOKEN VARCHAR2(50),
 LAST_USED TIMESTAMP NOT NULL,
 CONSTRAINT PK_TBL_PERSISTENT_LOGINS PRIMARY KEY(SERIES)
 );
 
 

 

-- 상품 테이블 생성
-- ID, TITLE, DESCRIPTION, WRITER, UUSER_NUM PRICE, REGION, REG_DATE, UPDATE_DATE, LIKE_COUNT, HITS_COUNT, ENABLED
CREATE TABLE TBL_PRODUCT(
    ID          NUMBER(10) CONSTRAINT PK_PRODUCT PRIMARY KEY,
    TITLE       VARCHAR2(400) NOT NULL,
    DESCRIPTION CLOB,
    WRITER      VARCHAR2(100) NOT NULL,
    USER_NUM    NUMBER(10) CONSTRAINT FK_PRODUCT2USER REFERENCES TBL_USER(ID),
    PRICE       NUMBER(10) NOT NULL,
    REGION      VARCHAR2(400) NOT NULL,
    REG_DATE    DATE DEFAULT SYSDATE,
    UPDATE_DATE DATE DEFAULT SYSDATE,
    LIKE_COUNT  NUMBER(10),
    HITS_COUNT  NUMBER(10),
    ENABLED CHAR(1) DEFAULT '1'
);

 

--첨부파일 테이블 생성
--UUID, UPLOAD_PATH, FILE_NAME, FILE_TYPE, OWNER_ID, OWNER_TYPE
CREATE TABLE TBL_ATTACH(
    UUID        VARCHAR2(100) NOT NULL,
    UPLOAD_PATH    VARCHAR2(200) NOT NULL,
    FILE_NAME    VARCHAR2(100) NOT NULL,
    FILE_TYPE    CHAR(1) DEFAULT '1',
    OWNER_ID    NUMBER(10) NOT NULL,
    --CLASS FULL PATH : EX - WWW.STUDY.COM.BULLETIN_BOARD.DOMAIN.POSTVO
    OWNER_TYPE    VARCHAR2(200) NOT NULL,
    CONSTRAINT PK_ATTACH PRIMARY KEY(OWNER_TYPE, OWNER_ID, UUID)
);

 

-- 게시글 테이블 생성
-- ID, TITLE, CONTENT, WRITER, USER_NUM, REG_DATE, UPDATE_DATE
CREATE TABLE TBL_POST(
    ID        NUMBER(10) CONSTRAINT PK_POST PRIMARY KEY,
    TITLE        VARCHAR2(2000) NOT NULL,
    CONTENT        CLOB,
    WRITER        VARCHAR2(200) NOT NULL,
    USER_NUM        NUMBER(10) CONSTRAINT FK_POST2MEMBER REFERENCES TBL_USER(ID) ON DELETE CASCADE,
    REG_DATE    DATE DEFAULT SYSDATE,
    UPDATE_DATE    DATE DEFAULT SYSDATE
);

 

-- 댓글 테이블 생성
-- ID, PID, RID, CONTENT, WRITER, USER_NUM, REG_DATE, UPDATE_DATE
CREATE TABLE TBL_REPLY(
    ID            NUMBER(10) CONSTRAINT PK_REPLY PRIMARY KEY,
    PID            NUMBER(10) CONSTRAINT FK_REPLY2POST REFERENCES TBL_POST(ID) ON DELETE CASCADE,
    RID            NUMBER(10) CONSTRAINT FK_REPLY2REPLY REFERENCES TBL_REPLY(ID) ON DELETE CASCADE,
    CONTENT        VARCHAR2(4000) NOT NULL,
    WRITER        VARCHAR2(200) NOT NULL,
    USER_NUM        NUMBER(10) CONSTRAINT FK_REPLY2MEMBER REFERENCES TBL_USER(ID) ON DELETE CASCADE,
    REG_DATE    DATE DEFAULT SYSDATE,
    UPDATE_DATE    DATE DEFAULT SYSDATE
);